import React, { useState, useEffect } from "react";
import axios from "axios";
import { jwtDecode as jwt_decode } from "jwt-decode";
import NavBar from "../components/NavBar";
import ChallengeBox from "../components/ChallengeBox";
import PointsButton from "../components/PointsButton";
import SettingsPopup from "../components/SettingsPopup";
import "../css/Settings.css";

function Profile() {
  const [userDetails, setUserDetails] = useState({});
  const token = localStorage.getItem("token");
  const userId = token ? jwt_decode(token).userId : null;

  useEffect(() => {
    const fetchUserDetails = async () => {
      if (!userId) return;

      try {
        const { data } = await axios.get(
          `http://localhost:5000/userdetails/${userId}`,
          {
            headers: {
              Authorization: `Bearer ${token}`,
            },
          }
        );
        setUserDetails(data);
      } catch (error) {
        console.error("Error fetching user details:", error);
      }
    };

    fetchUserDetails();
  }, [userId]);

  const [isPopupOpen, setIsPopupOpen] = useState(false);

  const togglePopup = () => {
    setIsPopupOpen(!isPopupOpen);
  };

  return (
    <>
      <header className="top-container">
        <div className="logo-points">
          <h2 className="logo">Splash</h2>
          <div className="settings-icon" onClick={togglePopup}>
            <img
              className="cogwheel"
              src="/assets/settingcogwheel.svg"
              alt="settings"
            ></img>
          </div>
        </div>
        <div className="profile-user-box">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="32"
            height="39"
            viewBox="0 0 32 39"
            fill="none"
          >
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M30.7265 22.953C30.7265 31.1492 24.0592 37.8166 15.8628 37.8166C12.4987 37.8166 9.39179 36.6943 6.89989 34.7995C3.31769 32.0844 1 27.785 1 22.953C1 19.546 3.47823 14.8233 8.36635 8.91446C11.9934 4.53467 15.6646 1.09689 15.7025 1.06385C15.7333 1.03509 15.769 1.01611 15.8067 1.00918C15.8251 1.00224 15.8441 1 15.8628 1C15.9197 1 15.9793 1.02101 16.0242 1.06385C16.0619 1.09689 19.7333 4.53467 23.3595 8.91446C28.2477 14.8233 30.7265 19.546 30.7265 22.953Z"
              fill="#456EFF"
              stroke="#456EFF"
            />
            <path
              d="M15.7263 37.8172C23.8473 37.8172 30.4533 31.4358 30.4533 23.5912C26.3067 27.6236 21.4279 27.9507 15.7267 23.5912C10.0255 19.2317 6.34344 23.4325 1 23.5912C1 28.216 3.29639 32.3309 6.84567 34.9295C9.31467 36.7431 12.393 37.8172 15.7263 37.8172Z"
              fill="#456EFF"
            />
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M30.7265 22.953C30.7265 31.1492 24.0592 37.8166 15.8628 37.8166C12.4987 37.8166 9.39179 36.6943 6.89989 34.7995C3.31769 32.0844 1 27.785 1 22.953C1 19.546 3.47823 14.8233 8.36635 8.91446C11.9934 4.53467 15.6646 1.09689 15.7025 1.06385C15.7333 1.03509 15.769 1.01611 15.8067 1.00918C15.8251 1.00224 15.8441 1 15.8628 1C15.9197 1 15.9793 1.02101 16.0242 1.06385C16.0619 1.09689 19.7333 4.53467 23.3595 8.91446C28.2477 14.8233 30.7265 19.546 30.7265 22.953Z"
              stroke="#456EFF"
            />
          </svg>
          <div className="profile-user">
            <h1 className="bold nomargin">{userDetails.name}</h1>
            <h2 Style="color: #456eff;" className="bold nomargin">
              {userDetails.points} points
            </h2>
          </div>
        </div>
      </header>
      {/* 
      <h2>Account Details</h2>
      <p>Email: {userDetails.email}</p>
      <p>Points: {userDetails.points}</p> */}

      <div className="profile-wrapper">
        <div className="challengeboxes">
          {/* import the challengebox  */}
          <ChallengeBox></ChallengeBox>
        </div>

        <div className="infoboxes">
          <div className="infobox">
            <svg
              className="iconsbox"
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 20 20"
              fill="none"
            >
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M9.99989 0.357178C7.82417 0.357178 5.6956 0.471463 3.65703 0.685749C2.91957 0.757603 2.22728 1.07388 1.69019 1.58431C1.1531 2.09474 0.802017 2.77004 0.692742 3.50289C0.250486 6.60114 0.245677 9.74616 0.678456 12.8457C0.905599 14.4757 2.27274 15.6343 3.8456 15.7815L4.15703 15.81L4.47846 15.8386V18.93C4.47857 19.0491 4.50846 19.1663 4.56538 19.2708C4.62231 19.3754 4.70448 19.4641 4.80442 19.5288C4.90436 19.5936 5.0189 19.6323 5.13761 19.6415C5.25633 19.6507 5.37546 19.63 5.48417 19.5815C7.49131 18.6815 8.7056 17.8072 10.1699 16.1672C12.2008 16.1555 14.2299 16.0439 16.2499 15.8329C17.0091 15.7592 17.7217 15.433 18.2736 14.9065C18.8255 14.38 19.1849 13.6835 19.2942 12.9286C19.5196 11.3835 19.6361 9.82438 19.6427 8.26289C19.6427 6.64861 19.5185 5.06575 19.3013 3.54718C19.1919 2.80418 18.8369 2.11918 18.293 1.60137C17.749 1.08356 17.0474 0.762739 16.2999 0.690035C14.207 0.470556 12.1042 0.359456 9.99989 0.357178ZM10.2442 4.88146C10.0636 4.84921 9.87821 4.85649 9.70074 4.9028C9.52327 4.94912 9.35795 5.03337 9.21619 5.14974C9.07442 5.26612 8.95957 5.41185 8.87956 5.57689C8.79955 5.74194 8.75629 5.92237 8.75274 6.10575C8.75274 6.34255 8.65867 6.56965 8.49123 6.73709C8.32379 6.90454 8.09669 6.99861 7.85989 6.99861C7.62308 6.99861 7.39598 6.90454 7.22854 6.73709C7.0611 6.56965 6.96703 6.34255 6.96703 6.10575C6.96703 4.21289 8.73703 2.76146 10.5927 3.13003C11.7785 3.36575 12.7399 4.33003 12.9756 5.51289C13.0942 6.10861 13.0256 6.67432 12.767 7.18289C12.517 7.67432 12.1213 8.05003 11.6856 8.34003C11.2913 8.60432 11.0785 8.76003 10.9542 8.88861C10.9321 8.91164 10.9121 8.93649 10.8942 8.96289C10.8936 9.19969 10.799 9.42657 10.6311 9.59361C10.4633 9.76065 10.236 9.85417 9.99917 9.85361C9.76237 9.85304 9.5355 9.75842 9.36845 9.59058C9.20141 9.42273 9.10789 9.19541 9.10846 8.95861C9.10846 8.40146 9.35274 7.97861 9.66703 7.65146C9.94846 7.36003 10.3299 7.10003 10.6942 6.85575C10.9627 6.67575 11.1056 6.51146 11.1756 6.37289C11.2519 6.21355 11.2691 6.03231 11.2242 5.86146C11.1712 5.62172 11.0508 5.40211 10.8771 5.22849C10.7035 5.05487 10.4839 4.93447 10.2442 4.88146ZM10.8927 12.2286C10.8927 11.9918 10.7987 11.7647 10.6312 11.5973C10.4638 11.4298 10.2367 11.3357 9.99989 11.3357C9.76309 11.3357 9.53598 11.4298 9.36854 11.5973C9.2011 11.7647 9.10703 11.9918 9.10703 12.2286V12.6215C9.10703 12.8583 9.2011 13.0854 9.36854 13.2528C9.53598 13.4203 9.76309 13.5143 9.99989 13.5143C10.2367 13.5143 10.4638 13.4203 10.6312 13.2528C10.7987 13.0854 10.8927 12.8583 10.8927 12.6215V12.2286Z"
                fill="#456EFF"
              />
            </svg>
            <div>
              <h2 className="bold nomargin">10 questions</h2>
              <p className="nomargin">answered</p>
            </div>
          </div>
          <div className="infobox">
            <svg
              className="iconsbox"
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 20 20"
              fill="none"
            >
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M10 20C16.4 20 20 16.4 20 10C20 3.6 16.4 0 10 0C3.6 0 0 3.6 0 10C0 16.4 3.6 20 10 20ZM15.1957 16.47C14.6919 15.5304 13.9425 14.7452 13.0275 14.198C12.1125 13.6508 11.0661 13.3622 10 13.3629C8.9342 13.3629 7.88835 13.6519 6.9737 14.199C6.05905 14.7461 5.30982 15.531 4.80571 16.47C5.99429 17.3243 7.68571 17.8571 10 17.8571C12.3143 17.8571 14.0057 17.3243 15.1957 16.47ZM13.3643 7.52714C13.3643 9.68 12.1529 10.8929 9.99857 10.8929C7.84571 10.8929 6.63429 9.68 6.63429 7.52714C6.63429 5.37286 7.84571 4.16143 9.99857 4.16143C12.1529 4.16143 13.3643 5.37286 13.3643 7.52714Z"
                fill="#456EFF"
              />
            </svg>
            <div>
              <h2 className="bold nomargin">1200 points</h2>
              <p className="nomargin">received total</p>
            </div>
          </div>
          <div className="infobox">
            <svg
              className="iconsbox"
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 20 20"
              fill="none"
            >
              <path
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M9.99989 0.357178C7.82417 0.357178 5.6956 0.471463 3.65703 0.685749C2.91957 0.757603 2.22728 1.07388 1.69019 1.58431C1.1531 2.09474 0.802017 2.77004 0.692742 3.50289C0.250486 6.60114 0.245677 9.74616 0.678456 12.8457C0.905599 14.4757 2.27274 15.6343 3.8456 15.7815L4.15703 15.81L4.47846 15.8386V18.93C4.47857 19.0491 4.50846 19.1663 4.56538 19.2708C4.62231 19.3754 4.70448 19.4641 4.80442 19.5288C4.90436 19.5936 5.0189 19.6323 5.13761 19.6415C5.25633 19.6507 5.37546 19.63 5.48417 19.5815C7.49131 18.6815 8.7056 17.8072 10.1699 16.1672C12.2008 16.1555 14.2299 16.0439 16.2499 15.8329C17.0091 15.7592 17.7217 15.433 18.2736 14.9065C18.8255 14.38 19.1849 13.6835 19.2942 12.9286C19.5196 11.3835 19.6361 9.82438 19.6427 8.26289C19.6427 6.64861 19.5185 5.06575 19.3013 3.54718C19.1919 2.80418 18.8369 2.11918 18.293 1.60137C17.749 1.08356 17.0474 0.762739 16.2999 0.690035C14.207 0.470556 12.1042 0.359456 9.99989 0.357178ZM10.2442 4.88146C10.0636 4.84921 9.87821 4.85649 9.70074 4.9028C9.52327 4.94912 9.35795 5.03337 9.21619 5.14974C9.07442 5.26612 8.95957 5.41185 8.87956 5.57689C8.79955 5.74194 8.75629 5.92237 8.75274 6.10575C8.75274 6.34255 8.65867 6.56965 8.49123 6.73709C8.32379 6.90454 8.09669 6.99861 7.85989 6.99861C7.62308 6.99861 7.39598 6.90454 7.22854 6.73709C7.0611 6.56965 6.96703 6.34255 6.96703 6.10575C6.96703 4.21289 8.73703 2.76146 10.5927 3.13003C11.7785 3.36575 12.7399 4.33003 12.9756 5.51289C13.0942 6.10861 13.0256 6.67432 12.767 7.18289C12.517 7.67432 12.1213 8.05003 11.6856 8.34003C11.2913 8.60432 11.0785 8.76003 10.9542 8.88861C10.9321 8.91164 10.9121 8.93649 10.8942 8.96289C10.8936 9.19969 10.799 9.42657 10.6311 9.59361C10.4633 9.76065 10.236 9.85417 9.99917 9.85361C9.76237 9.85304 9.5355 9.75842 9.36845 9.59058C9.20141 9.42273 9.10789 9.19541 9.10846 8.95861C9.10846 8.40146 9.35274 7.97861 9.66703 7.65146C9.94846 7.36003 10.3299 7.10003 10.6942 6.85575C10.9627 6.67575 11.1056 6.51146 11.1756 6.37289C11.2519 6.21355 11.2691 6.03231 11.2242 5.86146C11.1712 5.62172 11.0508 5.40211 10.8771 5.22849C10.7035 5.05487 10.4839 4.93447 10.2442 4.88146ZM10.8927 12.2286C10.8927 11.9918 10.7987 11.7647 10.6312 11.5973C10.4638 11.4298 10.2367 11.3357 9.99989 11.3357C9.76309 11.3357 9.53598 11.4298 9.36854 11.5973C9.2011 11.7647 9.10703 11.9918 9.10703 12.2286V12.6215C9.10703 12.8583 9.2011 13.0854 9.36854 13.2528C9.53598 13.4203 9.76309 13.5143 9.99989 13.5143C10.2367 13.5143 10.4638 13.4203 10.6312 13.2528C10.7987 13.0854 10.8927 12.8583 10.8927 12.6215V12.2286Z"
                fill="#456EFF"
              />
            </svg>
            <div>
              <h2 className="bold nomargin">12 years</h2>
              <p className="nomargin">active</p>
            </div>
          </div>
        </div>
      </div>

      <SettingsPopup
        isOpen={isPopupOpen}
        onClose={() => setIsPopupOpen(false)}
      ></SettingsPopup>
      <NavBar />
    </>
  );
}

export default Profile;
